# @yanice/import-boundaries

## Purpose

This package serves as a plugin for [yanice](https://www.npmjs.com/package/yanice).
Without yanice, the package is of little value.

## Installation

Install e.g. via npm as follows:

```
npm install --save-dev @yanice/import-boundaries
```

## Configuration

Configuration of the plugin is done in the `yanice.json`, see [here](https://github.com/abuob/yanice/blob/master/integration-tests/test-project/yanice.json) for an example:

```json
{
    "import-boundaries": {
        "importResolvers": {
            "**/*.some-extension": ["./some-custom-resolver.js"],
            "**/*.{js,ts}": ["import-resolver-es6"]
        },
        "exclusionGlobs": ["**/dist/**"],
        "postResolve": ["./post-resolve.js"],
        "assertions": ["only-direct-imports", "only-allow-configured-imports", "./some-custom-assertion.js"]
    }
}
```

### importResolvers

A map that maps glob-expressions to an array of import-resolvers.
An import-resolver accepts a file and its filepath and creates an "import-map".
See here for an example how a custom import resolver can be written: [dummy-resolver.js](https://github.com/abuob/yanice/blob/master/integration-tests/test-project/dummy-resolver.js)

### exclusionGlobs

An array of glob-expressions; all files matching any expression will be ignored when searching for files.
Note that by default, `.git`-folders and `node_modules`-folders are ignored.

### postResolve

The plugin will create an import-map for all files that matched.
In case anything is amiss or the plugin was not able to resolve certain imports, in this step we can do one final mapping.

### assertions

Array of officially provided assertions or custom assertions.
Currently supported:

-   `only-direct-imports`
-   `only-transitive-dependencies`
-   `only-allow-configured-imports`
-   `max-skipped-imports`

## Commands

The plugin can be invoked with the following parameters:

-   `--print-file-imports`: Will print file-import-maps as soon as they are available, without any yanice-project-related information.
-   `--print-assertion-data`: Will print all data that is being generated to run assertions.
    The aforementioned file-import-map, which file belongs to which project, and which project imports which project.
-   `--skip-post-resolvers`: Skips the post-resolvers.
-   `--generate`: Will print the project-dependencies based on the imports in the format that the yanice.json uses
-   `--assert`: The default-mode; will be used when `--print*` or `--generate` is not present. Runs the configured assertions.

### Examples

A good starting point is to print the project-map generated by the plugin.
Note that a dependency-scope (here: `build`) must be provided and configured in the `yanice.json`.

```
yanice plugin:import-boundaries build --print-project-imports
```

Note that the output might be fairly big; as it is in `*.json`-format, piping it into a file might be convenient:

```
yanice plugin:import-boundaries build --print-project-imports > project-import-map.json
```

Run the plugin for the `build`-dependency-scope, generating
the project-dependencies as per imports in the yanice.json-format:

```
yanice plugin:import-boundaries build --generate --skip-post-resolvers
```

Print the file-import-maps without any yanice-project-related information, also skipping any post-resolver:

```
plugin:import-boundaries a-depends-on-b --print-project-imports --skip-post-resolvers
```
